import:
    - recipe/statamic.php

config:
  application: 'statameet'
  repository: 'git@github.com:statameet/statameet.git'
  branch: 'deployment'

hosts:
  forge@68.183.75.15:
    deploy_path: '~/default'

tasks:
  deploy:assets:
    script:
      - 'cd {{release_path}} && npm ci && npm run production'
  deploy:
    - 'deploy:prepare'
    - 'deploy:vendors'
    - 'artisan:storage:link'
    - 'artisan:cache:clear'
    - 'deploy:assets'
    - 'statamic:stache:clear'
    - 'statamic:stache:warm'
    - 'deploy:publish'

after:
  deploy:failed: deploy:unlock
